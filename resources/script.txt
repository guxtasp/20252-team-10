CREATE DATABASE IF NOT EXISTS LabUFV;
USE LabUFV;

CREATE TABLE Usuario (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    senha VARCHAR(100) NOT NULL,  
    nivelAcesso INT NOT NULL
);

CREATE TABLE Laboratorio (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    departamento VARCHAR(100) NOT NULL
);

CREATE TABLE Gestor (
    id INT PRIMARY KEY,
    cadastrado_por_gestor_id INT, 
    laboratorio_id INT,
	FOREIGN KEY (laboratorio_id) REFERENCES Laboratorio(id),
    FOREIGN KEY (id) REFERENCES Usuario(id),
    FOREIGN KEY (cadastrado_por_gestor_id) REFERENCES Gestor(id)
);

CREATE TABLE Estudante (
    id INT PRIMARY KEY,
    matricula VARCHAR(20) NOT NULL,
    curso VARCHAR(100) NOT NULL,
    nivel VARCHAR(40) NOT NULL,
    cadastrado_por_gestor_id INT, 
    FOREIGN KEY (id) REFERENCES Usuario(id),
    FOREIGN KEY (cadastrado_por_gestor_id) REFERENCES Gestor(id)
);

CREATE TABLE PosGraduacao (
    id INT PRIMARY KEY,
    FOREIGN KEY (id) REFERENCES Estudante(id)
);



CREATE TABLE Reagente (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    quantidade INT NOT NULL,
    quantidadeCritica DOUBLE NOT NULL,
    referencia VARCHAR(50) UNIQUE NOT NULL,
    marca VARCHAR(50) NOT NULL,
    localArmazenamento VARCHAR(100),
    nivelAcesso INT NOT NULL,
    unidadeMedida VARCHAR(30) NOT NULL,
    laboratorio_id INT NOT NULL,
    cadastrado_por INT NOT NULL,
    FOREIGN KEY (laboratorio_id) REFERENCES Laboratorio(id),
    FOREIGN KEY (cadastrado_por) REFERENCES Gestor(id)
);

CREATE TABLE ReagenteLiquido (
    id INT PRIMARY KEY,
    densidade DOUBLE,
    volume DOUBLE,
    FOREIGN KEY (id) REFERENCES Reagente(id)
);

CREATE TABLE ReagenteSolido (
    id INT PRIMARY KEY,
    massa DOUBLE,
    estadoFisico VARCHAR(50),
    FOREIGN KEY (id) REFERENCES Reagente(id)
);

CREATE TABLE Retirada (
    id INT AUTO_INCREMENT PRIMARY KEY,
    usuario_id INT NOT NULL,
    reagente_id INT NOT NULL,
    dataHoraRetirada DATETIME NOT NULL,
    quantidadeRetirada INT NOT NULL,
    FOREIGN KEY (usuario_id) REFERENCES Usuario(id),
    FOREIGN KEY (reagente_id) REFERENCES Reagente(id)
);

CREATE TABLE Alerta (
    id INT AUTO_INCREMENT PRIMARY KEY,
    gestor_id INT NOT NULL,
    reagente_id INT NOT NULL,
    dataHoraEmissao DATETIME NOT NULL,
    tipo VARCHAR(50),
    situacao VARCHAR(50),
    FOREIGN KEY (gestor_id) REFERENCES Gestor(id),
    FOREIGN KEY (reagente_id) REFERENCES Reagente(id)
);

CREATE TABLE Associado (
    estudante_id INT NOT NULL,
    laboratorio_id INT NOT NULL,
    papel VARCHAR(50) NOT NULL,
    PRIMARY KEY (estudante_id, laboratorio_id),
    FOREIGN KEY (estudante_id) REFERENCES Estudante(id),
    FOREIGN KEY (laboratorio_id) REFERENCES Laboratorio(id)
);

-- ============================
-- DADOS FICTÍCIOS
-- ============================

-- Usuários
INSERT INTO Usuario (nome, email, senha, nivelAcesso) VALUES
('Ana Souza', 'ana.souza@ufv.br', 'ana123', 1),
('Bruno Lima', 'bruno.lima@ufv.br', 'bruno456', 1),
('Carla Mendes', 'carla.mendes@ufv.br', 'carla789', 2),
('Diego Nunes', 'diego.nunes@ufv.br', 'diego321', 2),
('Elisa Torres', 'elisa.torres@ufv.br', 'elisa654', 3),
('Fernando Alves', 'fernando.alves@ufv.br', 'fer111', 3),
('Gabriela Silva', 'gabriela.silva@ufv.br', 'gabi222', 3),
('Henrique Duarte', 'henrique.duarte@ufv.br', 'henri333', 2),
('Isabela Costa', 'isabela.costa@ufv.br', 'isa444', 3),
('João Martins', 'joao.martins@ufv.br', 'joao555', 1);

-- Laboratórios
INSERT INTO Laboratorio (nome, departamento) VALUES
('Laboratório de Química Geral', 'Química'),
('Laboratório de Física Aplicada', 'Física'),
('Laboratório de Biologia Molecular', 'Biologia'),
('Laboratório de Robótica', 'Engenharia'),
('Laboratório de Microscopia', 'Biologia');

-- Gestores
INSERT INTO Gestor (id, cadastrado_por_gestor_id, laboratorio_id) VALUES
(1, NULL, 1),
(2, 1, 2),
(10, 1, 4);

-- Estudantes
INSERT INTO Estudante (id, matricula, curso, nivel, cadastrado_por_gestor_id) VALUES
(3, '2025001', 'Engenharia Química', 'Graduação', 1),
(4, '2025002', 'Ciências Biológicas', 'Graduação', 2),
(5, '2025003', 'Medicina Veterinária', 'Pós-Graduação', 2),
(6, '2025004', 'Engenharia Mecânica', 'Graduação', 10),
(7, '2025005', 'Biotecnologia', 'Pós-Graduação', 10),
(8, '2025006', 'Farmácia', 'Graduação', 1),
(9, '2025007', 'Química', 'Graduação', 2);

-- Pós-Graduação
INSERT INTO PosGraduacao (id) VALUES
(5),
(7);

-- Reagentes
INSERT INTO Reagente (nome, quantidade, quantidadeCritica, referencia, marca, localArmazenamento, nivelAcesso, unidadeMedida, laboratorio_id, cadastrado_por) VALUES
('Ácido Sulfúrico', 500, 100, 'REF001', 'Sigma-Aldrich', 'Armário Química', 1, 'mL', 1, 1),
('Hidróxido de Sódio', 1000, 200, 'REF002', 'Synth', 'Armário Química', 1, 'g', 1, 1),
('Etanol 70%', 2000, 500, 'REF003', 'QuimLab', 'Armário Química', 2, 'mL', 1, 1),
('Solução Tampão pH 7', 500, 100, 'REF004', 'Neon', 'Geladeira Bio', 2, 'mL', 3, 2),
('Agarose', 250, 50, 'REF005', 'Invitrogen', 'Geladeira Bio', 2, 'g', 3, 2),
('Corante Cristal Violeta', 200, 50, 'REF006', 'Kasvi', 'Armário Bio', 3, 'mL', 5, 10);

-- Reagentes Líquidos
INSERT INTO ReagenteLiquido (id, densidade, volume) VALUES
(1, 1.84, 500),
(3, 0.79, 2000),
(4, 1.0, 500),
(6, 1.05, 200);

-- Reagentes Sólidos
INSERT INTO ReagenteSolido (id, massa, estadoFisico) VALUES
(2, 1000, 'Sólido'),
(5, 250, 'Sólido');

-- Associados (Estudante x Laboratório)
INSERT INTO Associado (estudante_id, laboratorio_id, papel) VALUES
(3, 1, 'Pesquisador'),
(4, 3, 'Pesquisador'),
(5, 3, 'Pós-Graduando'),
(6, 4, 'Pesquisador'),
(7, 4, 'Pós-Graduando'),
(8, 5, 'Pesquisador'),
(9, 1, 'Pesquisador');
